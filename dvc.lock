schema: '2.0'
stages:
  prepare_demo:
    cmd: uv run python src/glm/preprocess_2detect.py mode2 demo
    deps:
    - path: src/glm/datasets/raw/2detect
      hash: md5
      md5: 67e7e6227a3c83214c1c50fb338e4eea.dir
      size: 19026176
      nfiles: 6
    - path: src/glm/preprocess_2detect.py
      hash: md5
      md5: ccfb656291e0f83eff067e63aece625d
      size: 2538
    params:
      params.yaml:
        demo:
          data:
            raw_path: src/glm/datasets/raw/2detect
            processed_path: src/glm/datasets/processed/2detect
    outs:
    - path: src/glm/datasets/processed/2detect
      hash: md5
      md5: 714c75e736e98e6bc7d0dc4f76f59684.dir
      size: 31727360
      nfiles: 2
  run_demo:
    cmd: uv run python src/glm/run_demo.py
    deps:
    - path: src/glm/datasets/processed/2detect
      hash: md5
      md5: 714c75e736e98e6bc7d0dc4f76f59684.dir
      size: 31727360
      nfiles: 2
    - path: src/glm/run_demo.py
      hash: md5
      md5: e3c7c54289abaddc857cde7017478d21
      size: 1768
    params:
      params.yaml:
        demo:
          data:
            raw_path: src/glm/datasets/raw/2detect
            processed_path: src/glm/datasets/processed/2detect
    outs:
    - path: src/glm/images/demo/reconstruction.jpg
      hash: md5
      md5: 4d094a10b9b06e0a7a763ec31622441e
      size: 17981
    - path: src/glm/images/demo/sinogram.jpg
      hash: md5
      md5: 9564192459134caa2f0e79440ff057fc
      size: 41795
    - path: src/glm/images/demo/target.jpg
      hash: md5
      md5: 3d40d439da4a3c4e4f7cf1ce7a749f74
      size: 20319
  prepare_training:
    cmd: uv run python src/glm/preprocess_2detect.py mode2 train
    deps:
    - path: /home/emilien/datasets/raw/2detect
      hash: md5
      md5: e4ac8fdf7a5d8002a946f8b988c777d5.dir
      size: 316154324027
      nfiles: 92001
    - path: src/glm/preprocess_2detect.py
      hash: md5
      md5: 55e400fc88c0fa959bb7d81cbc86ba39
      size: 2717
    params:
      params.yaml:
        data:
          raw_path: /home/emilien/datasets/raw/2detect
          processed_path: /home/emilien/datasets/processed/2detect
    outs:
    - path: /home/emilien/datasets/processed/2detect
      hash: md5
      md5: c9b5188af6c5685168104b496816ee67.dir
      size: 182432320000
      nfiles: 11500
  pretraining:
    cmd: uv run python src/glm/pretrain.py
    deps:
    - path: /home/emilien/datasets/processed/2detect
      hash: md5
      md5: c9b5188af6c5685168104b496816ee67.dir
      size: 182432320000
      nfiles: 11500
    - path: src/glm/pretrain.py
      hash: md5
      md5: da48ee51826a3ba271c13affc12e2b07
      size: 5961
    params:
      params.yaml:
        pretrain_parameters:
          hyperparameters:
            learning_rate: 0.0005
            epochs: 1
            batch_size: 8
            num_workers: 2
            device: cuda:0
            downsampling: 1
          active_model: GLM
          models:
            GLM:
              kernel_size: 7
              kernel_dimension: 1
              padding: 3
              n_channels: 16
              normalize: true
              improved: true
              cached: false
              add_self_loops: true
              aggr: add
            sinogram_CNN:
              kernel_size: 7
              kernel_dimension: 2
              padding: 3
              n_channels: 16
    outs:
    - path: dvclive
      hash: md5
      md5: 6d14c294ce717877b1f6c47306f4624b.dir
      size: 59390
      nfiles: 7
    - path: src/glm/saved_models/pretrained_sinogram_model.pt
      hash: md5
      md5: 7e3c4b2a344cd8c2517c72620c0d0dd5
      size: 44611
